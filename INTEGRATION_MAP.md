# üéµ GenPlayer - Integration Map (Dove mettere mano)

## üì± SCHERMATA PLAYER (NowPlayingActivity)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  ‚Üê BACK  [16dp margin top]                           PRO ‚Üì  [x] ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ üîµ ‚è≥ Buffering... 45% (2.5 MB/s)                       ‚îÇ    ‚îÇ ‚Üê BANNER FEEDBACK
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ    (FeedbackBanner.kt)
‚îÇ                                                                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îÇ
‚îÇ  ‚îÇ                                                           ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                    [Album Art]                           ‚îÇ    ‚îÇ ‚Üê Artwork
‚îÇ  ‚îÇ                    (400x400 max)                         ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ                                                           ‚îÇ    ‚îÇ
‚îÇ  ‚îÇ     ‚óÑ Technical Details Overlay (PRO button click) ‚óÑ    ‚îÇ    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  Bohemian Rhapsody                                              ‚îÇ
‚îÇ  Queen                                                           ‚îÇ
‚îÇ  A Night at the Opera                                           ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ  320 kbps ‚Ä¢ 44.1 kHz ‚Ä¢ 16-bit ‚úÖ Bit-Perfect                   ‚îÇ ‚Üê Tech info
‚îÇ                                                                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  0:00  ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  3:45                              ‚îÇ
‚îÇ                                                                   ‚îÇ
‚îÇ        [‚óÑ‚óÑ]  [‚èØÔ∏è]  [‚ñ∫‚ñ∫]  [üîÄ]  [üîÅ]                           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîç DOVE VEDI COSA

### 1Ô∏è‚É£ **FEEDBACK BANNER** (Top, sotto back button)

**Dove vedi:** Subito sotto il back button, prima dell'artwork

**Cosa mostra:**
```
üîµ ‚è≥ Buffering... 45% (2.5 MB/s)           ‚Üê INFO (blu, auto-dismiss 3s)
üü° ‚ö†Ô∏è Risamplato: 44.1 ‚Üí 48 kHz             ‚Üê WARNING (arancio, auto-dismiss 3s)
üü¢ ‚úÖ FLAC 24-bit/96 kHz (bit-perfect)      ‚Üê SUCCESS (verde, auto-dismiss 3s)
üî¥ ‚ùå File corrotto - impossibile decodificare ‚Üê ERROR (rosso, user dismiss)
üîµ üéöÔ∏è USB DAC: Audiolab M-DAC (192 kHz)    ‚Üê INFO (blu, auto-dismiss 3s)
```

**Come settare:**
```kotlin
// In NowPlayingActivity.kt
private lateinit var feedbackBanner: FeedbackBanner

override fun onCreate(savedInstanceState: Bundle?) {
    // ...
    feedbackBanner = findViewById(R.id.feedbackBanner)  // ‚Üê Aggiungere nel layout

    // Mostra un messaggio di test
    feedbackBanner.showFormatInfo("FLAC", 24, 96)
}
```

**File da modificare:**
- ‚úèÔ∏è `activity_now_playing.xml` - Aggiungere il widget
- ‚úèÔ∏è `NowPlayingActivity.kt` - Inizializzare e usare

---

### 2Ô∏è‚É£ **RESAMPLING WARNING** (Se audio convertito)

**Dove vedi:** Nel feedback banner

**Trigger:** Quando ExoPlayer converte sample rate (es. 44.1 ‚Üí 48 kHz)

**Esempio:**
```
File: 44.1 kHz FLAC
Device: Forzato a 48 kHz dal sistema
‚Üì‚Üì‚Üì
Banner: üü° ‚ö†Ô∏è Risamplato: 44.1 ‚Üí 48 kHz (NON bit-perfect)
```

**Come funziona:**
```kotlin
// In NowPlayingActivity.kt
override fun onCreate(savedInstanceState: Bundle?) {
    // ...

    // Crea il monitor
    resamplingMonitor = ResamplingMonitor { inputHz, outputHz ->
        feedbackBanner.showResamplingWarning(inputHz, outputHz)
        AudioLog.resamplingDetected(inputHz, outputHz)
    }

    // Attacca a ExoPlayer
    controller?.addAnalyticsListener(resamplingMonitor)
}
```

**File da modificare:**
- ‚úèÔ∏è `NowPlayingActivity.kt` - Aggiungere ResamplingMonitor

---

### 3Ô∏è‚É£ **USB AUDIO INFO** (Se DAC USB connesso)

**Dove vedi:** Nel feedback banner

**Trigger:** Al caricamento della schermata (onCreate) oppure quando DAC si connette

**Esempio:**
```
DAC connesso: Audiolab M-DAC (192 kHz capable)
‚Üì‚Üì‚Üì
Banner: üîµ üéöÔ∏è USB DAC: Audiolab M-DAC (192 kHz)
```

**Come funziona:**
```kotlin
// In NowPlayingActivity.kt
override fun onCreate(savedInstanceState: Bundle?) {
    // ...

    val usbAnalyzer = USBAudioAnalyzer(this)
    val usbDevices = usbAnalyzer.getConnectedUSBDevices()

    if (usbDevices.isNotEmpty()) {
        val device = usbDevices.first()
        feedbackBanner.showUSBDeviceInfo(device.name, device.maxSampleRate)
    }
}
```

**File da modificare:**
- ‚úèÔ∏è `NowPlayingActivity.kt` - Aggiungere USBAudioAnalyzer check

---

### 4Ô∏è‚É£ **TECHNICAL PANEL** (PRO button, mostra overlay)

**Dove vedi:** Click su PRO badge ‚Üí mostra panel overlay sull'artwork

**Prima (cosa vedi adesso):**
```
File Information:
  File Size: 45.2 MB
  Compression: Lossless (FLAC)

Audio Format:
  Format: FLAC
  Bitrate: N/A
  VBR/CBR: ‚Äî
  Sample Rate: 96 kHz
  Bit Depth: 24-bit
  Channels: Stereo

Metadata:
  Duration: 3:45
  ReplayGain: ‚Äî
  Encoder: ‚Äî
```

**Dopo (aggiunto):**
```
... (tutto sopra) ...

Device Information:              ‚Üê NUOVO SECTION
  USB Audio: Audiolab M-DAC
  Max Sample Rate: 192 kHz
  Channels: 8

Playback Status:                ‚Üê NUOVO SECTION
  Resampling: NO ‚úÖ (96 kHz ‚Üí 96 kHz)
  Bit-Perfect: YES ‚úÖ
  Buffering: 100%
```

**Come mettere:**
```kotlin
// In NowPlayingActivity.kt, nel metodo toggleTechnicalDetailsPanel()
// o quando aggiorna il technical panel, aggiungere:

private fun updateTechnicalDetailsPanel(track: Track) {
    // ... (codice esistente) ...

    // AGGIUNGERE:
    // USB Audio Info
    val usbAnalyzer = USBAudioAnalyzer(this)
    val usbDevices = usbAnalyzer.getConnectedUSBDevices()
    if (usbDevices.isNotEmpty()) {
        val device = usbDevices.first()
        txtUSBDevice.text = "USB Audio: ${device.name}"
        txtUSBMaxHz.text = "Max: ${device.maxSampleRate} kHz"
    }

    // Resampling Status
    val resamplingInfo = resamplingMonitor.getResamplingInfo()
    txtResamplingStatus.text = resamplingInfo
}
```

**File da modificare:**
- ‚úèÔ∏è `activity_now_playing.xml` - Aggiungere TextViews per USB + Resampling info
- ‚úèÔ∏è `NowPlayingActivity.kt` - Popolare i nuovi TextViews

---

### 5Ô∏è‚É£ **FORMAT INFO LINE** (Sotto artist)

**Dove vedi:** Righe di testo sotto "Queen" ‚Üí "A Night at the Opera"

**Prima:**
```
Queen
A Night at the Opera
320 kbps ‚Ä¢ 44.1 kHz ‚Ä¢ 16-bit
```

**Dopo (aggiunto icon e info):**
```
Queen
A Night at the Opera
üü¢ 320 kbps ‚Ä¢ 44.1 kHz ‚Ä¢ 16-bit ‚Ä¢ CBR
```

**O meglio ancora con info resampling:**
```
Queen
A Night at the Opera
üü¢ 320 kbps ‚Ä¢ 44.1 kHz ‚Ä¢ 16-bit ‚Ä¢ ‚úÖ Bit-Perfect
```

**Come fare:**
```kotlin
// Nel txtTechInfo che esiste gi√†
private fun updateTechInfo(track: Track) {
    val isBitPerfect = resamplingMonitor.isCurrentlyResampling().not()
    val bitPerfectIcon = if (isBitPerfect) "‚úÖ" else "‚ö†Ô∏è"

    val techLine = "${track.bitrateKbps} kbps ‚Ä¢ " +
                   "${track.sampleRateHz} kHz ‚Ä¢ " +
                   "${track.bitDepth}-bit ‚Ä¢ " +
                   "$bitPerfectIcon"

    txtTechInfo.text = techLine
    txtTechInfo.visibility = View.VISIBLE
}
```

**File da modificare:**
- ‚úèÔ∏è `NowPlayingActivity.kt` - Aggiungere logica nel metodo che mostra tech info

---

## üìÇ FILE DA MODIFICARE (In ordine)

### Priority 1: Layout XML
```
‚úèÔ∏è app/src/main/res/layout/activity_now_playing.xml

Dove aggiungere FeedbackBanner:
  DOPO: <ImageButton android:id="@+id/btnBack" ... >
  PRIMA: <ScrollView android:id="@+id/mainContent" ... >

Codice da inserire:
  <com.genaro.radiomp3.ui.widgets.FeedbackBanner
      android:id="@+id/feedbackBanner"
      android:layout_width="match_parent"
      android:layout_height="wrap_content"
      android:layout_marginStart="16dp"
      android:layout_marginEnd="16dp"
      android:layout_marginTop="8dp"
      android:visibility="gone" />

Dove aggiungere USB/Resampling info nel technical panel:
  DENTRO: <ScrollView android:id="@+id/technicalDetailsPanel" ... >
  DOPO: <TextView android:id="@+id/txtEncoder" ... >

Codice da inserire:
  <!-- üéöÔ∏è DEVICE INFORMATION -->
  <TextView
      android:layout_width="match_parent"
      android:layout_height="wrap_content"
      android:text="üéöÔ∏è Device Information"
      android:textColor="#FFD700"
      android:textSize="16sp"
      android:textStyle="bold"
      android:layout_marginTop="16dp"
      android:layout_marginBottom="8dp" />

  <TextView
      android:id="@+id/txtUSBDevice"
      android:layout_width="match_parent"
      android:layout_height="wrap_content"
      android:text="USB Device: ‚Äî"
      android:textColor="#FFFFFF"
      android:textSize="14sp"
      android:layout_marginBottom="4dp" />

  <TextView
      android:id="@+id/txtUSBMaxHz"
      android:layout_width="match_parent"
      android:layout_height="wrap_content"
      android:text="Max Sample Rate: ‚Äî"
      android:textColor="#FFFFFF"
      android:textSize="14sp"
      android:layout_marginBottom="16dp" />

  <!-- ‚úÖ PLAYBACK STATUS -->
  <TextView
      android:layout_width="match_parent"
      android:layout_height="wrap_content"
      android:text="‚úÖ Playback Status"
      android:textColor="#FFD700"
      android:textSize="16sp"
      android:textStyle="bold"
      android:layout_marginTop="8dp"
      android:layout_marginBottom="8dp" />

  <TextView
      android:id="@+id/txtBitPerfect"
      android:layout_width="match_parent"
      android:layout_height="wrap_content"
      android:text="Bit-Perfect: ‚Äî"
      android:textColor="#FFFFFF"
      android:textSize="14sp"
      android:layout_marginBottom="4dp" />

  <TextView
      android:id="@+id/txtResamplingStatus"
      android:layout_width="match_parent"
      android:layout_height="wrap_content"
      android:text="Resampling: ‚Äî"
      android:textColor="#FFFFFF"
      android:textSize="14sp"
      android:layout_marginBottom="4dp" />

  <TextView
      android:id="@+id/txtBufferingStatus"
      android:layout_width="match_parent"
      android:layout_height="wrap_content"
      android:text="Buffering: ‚Äî"
      android:textColor="#AAAAAA"
      android:textSize="14sp"
      android:layout_marginBottom="16dp" />
```

---

### Priority 2: NowPlayingActivity.kt

```kotlin
// AGGIUNGERE IMPORTS
import com.genaro.radiomp3.ui.widgets.FeedbackBanner
import com.genaro.radiomp3.playback.audio.ResamplingMonitor
import com.genaro.radiomp3.playback.audio.USBAudioAnalyzer
import com.genaro.radiomp3.data.prefs.PreferenceManager
import com.genaro.radiomp3.logging.AudioLog

class NowPlayingActivity : BaseActivity() {

    // AGGIUNGERE FIELD VARIABILI
    private lateinit var feedbackBanner: FeedbackBanner
    private lateinit var resamplingMonitor: ResamplingMonitor
    private lateinit var usbAnalyzer: USBAudioAnalyzer
    private lateinit var preferenceManager: PreferenceManager

    // Per i nuovi TextViews
    private lateinit var txtUSBDevice: TextView
    private lateinit var txtUSBMaxHz: TextView
    private lateinit var txtBitPerfect: TextView
    private lateinit var txtResamplingStatus: TextView
    private lateinit var txtBufferingStatus: TextView

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_now_playing)

        // AGGIUNGERE - Inizializzare components
        feedbackBanner = findViewById(R.id.feedbackBanner)
        preferenceManager = PreferenceManager.getInstance(this)
        usbAnalyzer = USBAudioAnalyzer(this)

        // Nuovi TextViews
        txtUSBDevice = findViewById(R.id.txtUSBDevice)
        txtUSBMaxHz = findViewById(R.id.txtUSBMaxHz)
        txtBitPerfect = findViewById(R.id.txtBitPerfect)
        txtResamplingStatus = findViewById(R.id.txtResamplingStatus)
        txtBufferingStatus = findViewById(R.id.txtBufferingStatus)

        // AGGIUNGERE - Check se feedback banner abilitato
        lifecycleScope.launch {
            val showFeedback = preferenceManager.getBoolean(
                "show_feedback_banner",
                true
            )
            feedbackBanner.visibility = if (showFeedback) View.VISIBLE else View.GONE
        }

        // AGGIUNGERE - Setup ResamplingMonitor
        resamplingMonitor = ResamplingMonitor { inputHz, outputHz ->
            feedbackBanner.showResamplingWarning(inputHz, outputHz)
            AudioLog.resamplingDetected(inputHz, outputHz)

            // Update technical panel
            updateResamplingStatus(inputHz, outputHz)
        }
        controller?.addAnalyticsListener(resamplingMonitor)

        // AGGIUNGERE - Check USB devices
        checkUSBDevices()

        // ... resto del codice ...
    }

    // AGGIUNGERE - Nuovo metodo
    private fun checkUSBDevices() {
        val devices = usbAnalyzer.getConnectedUSBDevices()
        if (devices.isNotEmpty()) {
            val device = devices.first()
            feedbackBanner.showUSBDeviceInfo(device.name, device.maxSampleRate)
            AudioLog.usbDeviceDetected(device.name, device.maxSampleRate)

            // Update technical panel
            txtUSBDevice.text = "USB Audio: ${device.name}"
            txtUSBMaxHz.text = "Max: ${device.maxSampleRate} kHz"
        }
    }

    // AGGIUNGERE - Nuovo metodo
    private fun updateResamplingStatus(inputHz: Int, outputHz: Int) {
        val isBitPerfect = inputHz == outputHz
        txtBitPerfect.text = "Bit-Perfect: ${if (isBitPerfect) "‚úÖ YES" else "‚ùå NO"}"
        txtResamplingStatus.text = if (isBitPerfect) {
            "‚úÖ No resampling ($inputHz kHz)"
        } else {
            "‚ö†Ô∏è Resampling: $inputHz ‚Üí $outputHz kHz"
        }
    }

    // MODIFICARE - Nel metodo updateTechnicalDetailsPanel()
    private fun updateTechnicalDetailsPanel(track: Track) {
        // ... codice esistente ...

        // AGGIUNGERE alla fine:
        updateResamplingStatus(
            track.sampleRateHz ?: 44100,
            track.sampleRateHz ?: 44100  // TODO: get actual device output Hz
        )
        checkUSBDevices()
    }
}
```

---

### Priority 3: PlayerHolder.kt (Log events)

```kotlin
// AGGIUNGERE IMPORT
import com.genaro.radiomp3.logging.AudioLog

class PlayerHolder(...) {

    // TROVARE metodo: onDownstreamFormatChanged()
    // AGGIUNGERE all'inizio o in un punto logico:

    override fun onDownstreamFormatChanged(...) {
        val format = ... // gi√† calcolato
        val bitDepth = ... // gi√† calcolato
        val sampleRate = ... // gi√† calcolato
        val channels = ... // gi√† calcolato

        // AGGIUNGERE:
        AudioLog.formatDetected(format, bitDepth, sampleRate, channels)

        // ... resto del codice ...
    }

    // TROVARE metodo: onMetadataChanged()
    // AGGIUNGERE:

    onMetadataChanged?.invoke(title, artist, artworkUrl)
    AudioLog.metadataLoaded(title ?: "Unknown", artist ?: "Unknown", album ?: "Unknown")
}
```

---

## üéØ INTEGRATION ORDER

1. **First:** Aggiungere FeedbackBanner nel layout XML
2. **Second:** Aggiungere TextViews per USB/Resampling nel technical panel
3. **Third:** Inizializzare in NowPlayingActivity.onCreate()
4. **Fourth:** Aggiungere ResamplingMonitor hook
5. **Fifth:** Aggiungere USBAudioAnalyzer check
6. **Sixth:** Aggiungere AudioLog calls in PlayerHolder
7. **Test:** Play a FLAC file e guarda il feedback banner

---

## ‚úÖ CHECKLIST FINALE

```
Layout (activity_now_playing.xml):
‚òê FeedbackBanner aggiunto dopo back button
‚òê txtUSBDevice aggiunto nel technical panel
‚òê txtUSBMaxHz aggiunto nel technical panel
‚òê txtBitPerfect aggiunto nel technical panel
‚òê txtResamplingStatus aggiunto nel technical panel
‚òê txtBufferingStatus aggiunto nel technical panel

Activity (NowPlayingActivity.kt):
‚òê Imports aggiunti
‚òê lateinit var feedbackBanner aggiunto
‚òê lateinit var resamplingMonitor aggiunto
‚òê lateinit var usbAnalyzer aggiunto
‚òê latein it var preferenceManager aggiunto
‚òê findViewById per tutti i nuovi TextViews
‚òê checkUSBDevices() method aggiunto
‚òê updateResamplingStatus() method aggiunto
‚òê ResamplingMonitor creato e aggiunto a controller
‚òê Preferences check per feedback banner visibility
‚òê updateTechnicalDetailsPanel() modificato

PlayerHolder (PlayerHolder.kt):
‚òê AudioLog imports aggiunto
‚òê AudioLog.formatDetected() call aggiunto
‚òê AudioLog.metadataLoaded() call aggiunto
```

---

## üöÄ POI VEDRAI

**Quando avvii l'app:**

1. Scegli un file audio da LocalMusicActivity
2. Opens NowPlayingActivity
3. **Vedi il feedback banner** (se non √® stato disabilitato nelle prefs)
4. Vedi il USB audio info (se DAC connesso)
5. Vedi il resampling warning (se audio convertito)
6. Tap PRO button ‚Üí vedi il nuovo technical panel con Device Info + Playback Status
7. Logs salvati in file (se file logging abilitato)

**Esempio:**
```
User taps: "Bohemian Rhapsody.flac" (24-bit, 96 kHz)
‚Üì
NowPlayingActivity opens
‚Üì
FeedbackBanner shows: "üü¢ ‚úÖ FLAC 24-bit/96 kHz (bit-perfect)"
‚Üì
If USB DAC: "üîµ üéöÔ∏è USB DAC: M-DAC (192 kHz)"
‚Üì
User taps PRO
‚Üì
Technical panel shows:
  Device Information:
    USB Audio: Audiolab M-DAC
    Max Sample Rate: 192 kHz
  Playback Status:
    Bit-Perfect: ‚úÖ YES
    Resampling: ‚úÖ No resampling (96 kHz ‚Üí 96 kHz)
```

---

Vuoi che cominci con il passo 1 (modificare il layout)? üëç
